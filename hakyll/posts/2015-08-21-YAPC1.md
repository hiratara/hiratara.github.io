---
title: 今日はYAPC::Asia TOKYO 2015 Day 1 の日です
---

今日もビッグサイトの近くにおります。[gihyo.jpさんのレポート](http://gihyo.jp/news/report/01/yapcasia2015/0001)も更新されていますので、ぜひご覧くださいませ。

## オープニング

* @yapcasia 使ってね
* 5トラックあるよ
* タグは #yapcasia[A-E] でわけてね
* 同時通訳あるよ
* wifiのトラフィックレポートあるよ
* [ベストトーク投票](http://yapcasia.org/2015/vote/form)してね
* 6Fでランチあるよ（300食）。明日はランチセッションも別であるよ
* 懇親会18時からだよ
* スポンサーには感謝しましょう
* blogを書くまでがYAPC

## Larry Wallさん 「メリークリスマス！」

* Larryは今年61才
* 「2」にまつわる悪いことがあった
* 「6」でも「.pl」でもない話をする？
* トールキン　ホビット物語、指輪物語
    * 6本の映画。3*2本
    * 3+2 = 5 (!) Perl 5は決戦の行方
* Perl5は成功し、今でも成功を収めている
* Perl5はホビット物語、Perl6は指輪物語
* どちらも「15」年の労力
* N年かかったかどうかは、過去のことであれば関係ない
* 「2つのパーティー」「山を登る旅路の物語」
* 指輪物語はホビット物語から盗んだ点が多い
* Perlも成長の物語
* 様々な敵 - 「Wood Wide Web」
* Second System Syndrome を克服した Perl6
* Perl6はPerl5から色々盗んでいる
    * シジル
	* 簡単なことは簡単に
	* 実践的
* Perlが好かれているのは表面上ではなく真相の部分
* Perl6は表面の部分は代わっている
* Perl5には欠点がある
* Unixの正規表現やawkの型、Cの演算子
* Perl6では正規表現を再設計。Perl6のパーサをパターンで書ける
    * 他の言語はPerl5の正規表現を真似ているのは皮肉
* Perl6のいいところは？ → 経験しないとわからない
* どうやるかより何をやるか
* 型 - Mooseのようなもの。Meta Object Protocol
    * 今までの言語でここまで柔軟なものはない
* multi path parsingを整理
    * 正規表現 「//x がデフォルト」「パターンはstringではなくlanguage」
    * 1 path parsing 言語ごとに切り替える「Mixins」
* 単位元の扱い、大きな整数
* 言語を設計することは世界を設計すること
* 仲間。IRCには200人がログインしている
    * トロールもいるが仲良くしようとしている
    * 意見が違ってもいいけど仲良くしたい
* Perl5 スレッドとグローバル変数
    * BEGIN, CHECK, INIT, END : フェーザー
	* CHECK コンパイルの終わり、INIT ランタイムの始まり 
	* CATCH、CONTROL 例外処理
    * `signal(SIGINT).act: { ... }` プリミティブとして
	* マルチコアに対して対応
* `0, 1, *+* ... *` フィボナッチ
* `my ($a, $b, $c) = 42 xx *` lazy list
* contextの決定は実行時
* 実行時例外 : pythonよりクリーンな言語にできる
* 実行時の字句解析
* ANNOUNCEMENT!
    * christmas??
	* 2015!! の予定のつもりで頑張ってる
    * ボランティアなので。人生の方が大事だよね
* 機能を固めてる段階。今後は安定版のメンテも行う
* まずはrakudo。MoarVMも
* `-Ofun`
* Perl6のリライトの3分野
    * NFG : ユニコードのNFD, NFC
	* NSA : 科学用行列計算
	* GLR : セマンティックの単純化。リストのリストをできるよう
* 「正しく失敗する」
    * Perl6は失敗すると想定していた
	* Perl5は欠点があるが使われている。Perl5のよくない部分を直す
	* boot strapのPerl6コンパイラはまだ
* ユーザの邪魔をしない言語。自然言語のような言語
* 指輪物語から得たことは多い
* Perl7の設計できるまで長生きするかもね。
* パーティーを楽しみましょう！

## aerealさん、灘友さん「世界展開する大規模ウェブサービスのデプロイを支える技術」

* Miiverse
    * 世界展開。リージョン跨ぎ
    * Wii Uや3DSのアバターサービス
    * PC、スマホからも利用可能
    * 全てをWEBベースで実装
    * ゲームからAPIを叩くことも。専用ライブラリも
* インフラはHatena、クライアントはNintendo
    * ローカライズや運営は海外ごと
    * JS/US/EUの3リージョン構成
* Proxy server, AppServer, DB
    * DBはマルチマスタで相互レプリケーション
    * PC版はUSリージョンのみ
* Timeline, Empathy, Notificationを処理を分離。RESTで
* Capistrano2 + Git : いわゆるpull型
    * 海を越えると `git pull` は辛い
    * Gitサーバが耐えられなくなる
* Git slaveを用意する
    * lsyncdでinode監視してrsync
    * ファイル数多すぎてlsyncdの上限を超えた事件
    * rsync中のgit fetchで配布物がサーバ毎に変わる事件
* ロールでデプロイを分ける。ランダムスリープ
* デプロイ対象サーバの管理は Mackerel APIを使って
    * net-sshが負荷でセグフォするなど
    * サーバ毎にroleを分けてる
    * サブシステムはMackerelでAutoScale
* 内容による手動対応も多い

ここからバトンタッチ。

* 昔はRedmineで開発していた
* GitHub Enterpriseを導入
* コードレビュー用の `ghe` というリモートを別に用意している
    * 2箇所に `push` が必要
    * Merge pull requestボタンは使わない (GHE上でマージすると `HEAD` の不一致が起こる可能性)
* 複数のGitリポジトリの同期
    * `google/hesokuri` Clojureで書かれている
        * マッピングは静的に決まる
        * `ghe` のメンテなどに耐えられない
    * `ghm` はてな製
        * Webアプリ。同期したりしなかったり
	* 同期が直列 (リポジトリが増えるときつい)
	* 古いリビジョンのデプロイ
* 新たなgit同期システムを開発
    * JSONのREST API群
    * Gitサーバ登録・取得、マスタ昇格・降格、リポジトリ、ジョブ実施
    * GHEへpush → リポジトリsyncへWEB HOOK → `pull@して`push`
    * HTTP POSTすればいいだけなのでいろいろなサービスとの連携が容易
    * 複数スレーブを扱える、同期ジョブの並列実行

ここでまたバトンタッチ。

* pull型の問題
    * 全部 `commit` する場合 : リポジトリが肥大化（コンパイルしたものも）
    * ソースだけの場合 : デプロイが長い、違う成果物
* Consulとstretcher
    * 配布物をAmazon S3などへ保存
    * デプロイのmanifest(YAML)も
    * consul event でイベント通知
    * イベントを受けてデプロイを実施
    * consulなので並列
    * S3なので負荷は考えなくていい
    * gitリポジトリに成果物は不要
    * 追加、rollbackなどもmanifest指定だけ
* 成果物はjenkins先生におまかせ
* 100台へのデプロイでベンチ
    * 1,142秒から29秒
    * `git pull` がそんなに早くない、という話
* AutoScaleとの連携をしたい (ただし、初回はconsulイベントは送れない)
* Miiverse での利用もしたい (3リージョン必要)
* デプロイの高速化で、価値のお届けも高速化
* Q. どの言語で？ なぜ？
    * A. Perl5。MiiverseなどはPerl5で実装されている。開発を支えるものなので冒険せずに済むもの
* Q. デプロイの頻度は？
    * A. 2週間に一度。bug fixがあればいつでも
* Q. capistranoでデプロイに失敗した時の検出は
    * A. strecherは成功・失敗のコマンドフックがある。Ikachan経由で通知を
* Q. Merge pull request ボタンは使えるようになった？
    * A. リポジトリ同期システムがあれば使えるようになった
* Q. コードデプロイの検討は？
    * A. 検討してない。確かまだリリースされていなかった
* Q. consulは台数が少ないとメリットない？
    * A. 30～50台くらいでgitサーバの負荷が高くなる
