<!DOCTYPE HTML>
<html>

<head>
  <title>Born in Tomakomai city - Top</title>
  <meta name="description" content="A blog for programmer" />
  <meta name="keywords" content="perl,haskell,mathematics" />
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <link rel="stylesheet" type="text/css" href="./css/style.css" />
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <!-- Google Analytics tracking codes -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-7637699-4', 'hiratara.github.io');
          ga('send', 'pageview');

        </script>
</head>

<body>
        <!-- facebook SDK -->
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=100848266724416";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
  <div id="main">
    <div id="header">
      <div id="logo">
        <div id="logo_text">
          <h1><a href="./">Born in <span class="logo_colour">Tomakomai</span> city</a></h1>
          <h2>A programmer who loves mathematics</h2>
        </div>
      </div>
      <div id="menubar">
        <ul id="menu">
          <li><a href="./">Home</a></li>
          <li><a href="./about.html">About</a></li>
          <li><a href="./contact.html">Contact</a></li>
          <li><a href="./archive.html">Archive</a></li>
        </ul>
      </div>
    </div>
    <div id="content_header"></div>
    <div id="site_content">
      <div class="sidebar">
        <h3>Useful Links</h3>
        Nothing
      </div>
      <div id="content">
        

<div>
  <h1>reveal.js on hakyll</h1>
<div class="post-info">
    Posted on <a href="./posts/2015-02-28-revealjs-on-hakyll.html">February 28, 2015</a>
    <!-- facebook button -->
    <div class="fb-like" data-href="http://hiratara.github.io/posts/2015-02-28-revealjs-on-hakyll.html" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
    <!-- Twitter button -->
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://hiratara.github.io/posts/2015-02-28-revealjs-on-hakyll.html" data-text="reveal.js on hakyll" data-via="hiratara">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</div>
<p>
    <p>数式を使ったスライドを作るのに、<a href="http://www.mathjax.org/">mathjax</a>と<a href="http://lab.hakim.se/reveal-js">reveal.js</a>の組み合わせはなかなかお手軽でよい。さらに<a href="https://github.com/hakimel/reveal.js/">github pages</a>を使えば、自前サーバなどを用意しなくてもプレゼン環境が整う。これは、<a href="http://nineties.github.io/category-seminar/">2年前の圏論勉強会</a>でも使われていた組み合わせである。</p>
<p>現在このページは<a href="http://jaspervdj.be/hakyll/">Hakyll</a>で管理しているので、スライドもmarkdownで書いてHakyllで管理して一緒に上げてしまうと楽かなと思って環境を整えた。</p>
<h2 id="方法1.-pandocのスライド生成機能を使う">方法1). Pandocのスライド生成機能を使う</h2>
<p>始めにこちらの方法を試してみた。<a href="http://johnmacfarlane.net/pandoc/demos.html">Pandocのデモ</a>にもあるように、Pandocにはreveal.jsを使ったスライドを生成する機能がある。HakyllはPandocを呼び出しているので、この機能を使うといいと考えた。</p>
<p>まず、今回の主役はreveal.jsは <code>/reveal.js/</code> というpathに展開しておき、単純にコピーするよう <code>site.hs</code> に書く。</p>
<pre><code>    match &quot;reveal.js/**&quot; $ do
        route   idRoute
        compile copyFileCompiler</code></pre>
<p>プレゼンは <code>presentations/</code> ディレクトリに置き、ブログポストと同様にコンパイルをかける。ここでPandocを噛ませる際に、reveal.jsを使うようにしてやるとよい。以下のように書いた</p>
<pre><code>  revealTemplate &lt;- (\ (Right x) -&gt; x) `fmap` getDefaultTemplate Nothing &quot;reveal

  .. snip ..

    match &quot;presentations/*&quot; $ do
      let w = defaultHakyllWriterOptions {
            PD.writerSlideVariant = PD.RevealJsSlides
            , PD.writerTemplate = revealTemplate
            , PD.writerStandalone = True
            , PD.writerHTMLMathMethod = MathJax mathjaxURL
            , PD.writerHtml5 = True
            , PD.writerVariables = [(&quot;revealjs-url&quot;, &quot;/reveal.js&quot;)]
            , PD.writerIncremental = True
            }
      route $ setExtension &quot;html&quot;
      compile $ pandocCompilerWith defaultHakyllReaderOptions w</code></pre>
<p>コマンドラインでreveal.jsを吐かせるのは非常に簡単だが、ライブラリ経由で実際に走らせるには自分で引数を作る必要があってかなり骨が折れた。<a href="https://github.com/jgm/pandoc/blob/master/pandoc.hs#L1175">pandoc.hs</a>とか<a href="https://github.com/jgm/pandoc/blob/master/src/Text/Pandoc.hs#L273">Pandoc.hs</a>とかを見ると答えが出ている。</p>
<p>この方法でプレゼンを吐くことはできたのだが、以下の問題があった。</p>
<ul>
<li>実装がめんどくさかった</li>
<li>(現時点で) reveal.jsの3.0.x系に対応できていない</li>
<li>reveal.js のmathjaxプラグインを使わず、自前でmathjaxと統合している</li>
</ul>
<h2 id="方法2.-hakyllのテンプレート機能を使う">方法2). hakyllのテンプレート機能を使う</h2>
<p>そもそもhakyllは<a href="https://hackage.haskell.org/package/hakyll-4.6.6.0/docs/Hakyll-Web-Template.html">テンプレート機構を持っている</a>ので、欲しいのはmarkdownをhtmlに変える機能だけのはず。なので、Pandocにstandaloneなhtmlを吐いてもらうのをやめることにする。</p>
<p>まず、<code>./reveal.js/test/examples/math.html</code> をコピって、 <a href="https://github.com/hiratara/hiratara.github.io/blob/master/hakyll/templates/presentation.html">templates/presentation.html</a>を作った。html化されたスライドを埋めたいところを <code>$body</code> にして、タイトルやら著者はメタデータから取ってきて1枚目のスライドに埋めてやればO.K.。</p>
<p>で、<code>site.hs</code> ではPandocにmarkdownのhtml化だけやらせる。ただし、reveal.jsで使えるようなhtmlを生成してもらう必要があるので、そのためのオプションはつける必要がある。</p>
<pre><code>    match &quot;presentations/*&quot; $ do
      let w = defaultHakyllWriterOptions {
            PD.writerSlideVariant = PD.RevealJsSlides
            , PD.writerHTMLMathMethod = MathJax undefined
            , PD.writerHtml5 = True
            , PD.writerIncremental = True
            }
      let r = let r' = defaultHakyllReaderOptions in r' {
            PD.readerExtensions = Set.filter (/= PD.Ext_auto_identifiers) (PD.r\
eaderExtensions r')
            }
      route $ setExtension &quot;html&quot;
      compile $ do
        item &lt;- pandocCompilerWith r w
        item &lt;- loadAndApplyTemplate &quot;templates/presentation.html&quot; postCtx item
        return item</code></pre>
<p><code>RevealJsSlides</code>は適切な形式のhtmlを吐くために必要、<code>writerIncremental</code> を指定するとリストが一つずつ表示されるように <code>class=&quot;fragment&quot;</code> が加えられる。 <code>MathJax undefined</code>は数式をmathjaxが読めるような形式でhtml化するのに必要となる。</p>
<p>最後に <code>Ext_auto_identifiers</code> を除いている部分だが、reveal.jsの最新版(3.0.0)は<code>&lt;div&gt;</code>の<code>id</code>属性をURLに使うようで、<code>id</code>属性を自動生成されると挙動に問題が出てしまった。そのために除いている。</p>
<p>これで <code>presentations/</code> 以下にmarkdownを置くと <a href="http://hiratara.github.io/presentations/2015-03-21_monadbase_vol2.html#/">スライドが生成される</a>。デザインがいまいち気に食わないのはreveal.jsを使う度に思う課題である。日本語と相性そんなに良くないのかなあ。</p>
</p>

</div>



<div>
  <h1>統計学入門(東京大学出版会)練習問題7.6</h1>
<div class="post-info">
    Posted on <a href="./posts/2015-01-20-statistics-book.html">January 20, 2015</a>
    <!-- facebook button -->
    <div class="fb-like" data-href="http://hiratara.github.io/posts/2015-01-20-statistics-book.html" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
    <!-- Twitter button -->
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://hiratara.github.io/posts/2015-01-20-statistics-book.html" data-text="統計学入門(東京大学出版会)練習問題7.6" data-via="hiratara">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</div>
<p>
    <p>表題の件、 <span class="math">\(N((0, 0), (\sigma_1, \sigma_2, \rho))\)</span> となってるが、共分散に<span class="math">\(\rho\)</span>の文字を使うのは不自然だし解答とも合わないので誤植だと思われる。<span class="math">\(N((0, 0), (\sigma_1, \sigma_2, \sigma_1 \sigma_2 \rho))\)</span>が正しい。</p>
</p>

</div>



<div>
  <h1>今日は「マーケティングテクノロジーの最先端を支える技術を大公開！」の日です</h1>
<div class="post-info">
    Posted on <a href="./posts/2014-12-16-MarketingTech.html">December 16, 2014</a>
    <!-- facebook button -->
    <div class="fb-like" data-href="http://hiratara.github.io/posts/2014-12-16-MarketingTech.html" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
    <!-- Twitter button -->
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://hiratara.github.io/posts/2014-12-16-MarketingTech.html" data-text="今日は「マーケティングテクノロジーの最先端を支える技術を大公開！」の日です" data-via="hiratara">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</div>
<p>
    <p><a href="http://eventdots.jp/event/263388">マーケティングテクノロジーの最先端を支える技術を大公開！</a>に参加しています。適当に内容をメモします。</p>
<h2 id="あいさつ">あいさつ</h2>
<ul>
<li>えむてぃー“ぶれいん”さま</li>
</ul>
<h2 id="対談アドテクが見据える未来のはなし-田中さん明石さん">対談『アドテクが見据える未来のはなし』 / 田中さん、明石さん</h2>
<ul>
<li>田中さんより
<ul>
<li>B2Bも最近やろうとしている</li>
<li>BrandSafeはてな : 広告枠が2ch系か、アダルトか判断</li>
</ul></li>
<li>明石さんより
<ul>
<li>関連会社について</li>
<li>「えむてぃーばーん」です</li>
</ul></li>
<li>明: 広告の未来はどうなる？これがわかれば苦労しない</li>
<li>田: ターゲティングの精度の向上。データを加工してアルゴリズムに加工
<ul>
<li>嫌われないような最適な広告を出せるようになるといい</li>
</ul></li>
<li>明: はてなはなにを？</li>
<li>田: BrandSafeはてな。今まではB2C向けサービス。
<ul>
<li>スパム判定アルゴリズムを応用</li>
<li>はてなブックマーク関連のデータが利用できると面白い</li>
<li>プライバシーへの配慮は必要</li>
</ul></li>
<li>明: はてなでプライバシーデータ使ってはてなで炎上？</li>
<li>田: よくある。炎上しても受け入れるようにしている</li>
<li>明: アドテクは回帰している。
<ul>
<li>バナー、email、検索連動、アドネットワーク、DSP、</li>
<li>DSPにて枠売りからimpression売りに変化</li>
<li>またアドネットワークに移りつつある</li>
<li>IoTにおいてコミュニケーションがまた変わる</li>
</ul></li>
<li>田: はてなはアドテクもやってる
<ul>
<li>自社のメディアへの広告の出し方。枠を持ってる</li>
<li>枠の進化には興味がある</li>
<li>いかにいいアドを出すか。ネイティブアドとか</li>
<li>ユーザに受け入れられる広告を出すところを大事</li>
<li>どう考える？</li>
</ul></li>
<li>明: バナーは広告っぽい。嫌われるだろうと思ってやってる
<ul>
<li>ネイティブアドは受け入れられやすい</li>
<li>IoT。演算装置を持たなかったものが演算装置を持つように</li>
<li>街の広告とかがテクノロジーで置き換えられる</li>
<li>「マーケティング」＝デジタル、の時代を目指す</li>
</ul></li>
<li>田: はてなブックマークのトップに何を出すかやってる(広告ではない話)
<ul>
<li>ネイティブアドとかやると、広告とコンテンツがあいまいになる</li>
<li>アドテクがカバーしてくれると面白い</li>
</ul></li>
<li>明: 海外ではそのような動きが始まっている</li>
<li>田: 広告も含めたWEBメディアの設計</li>
<li>明: テクノロジーは現在どのような進化を遂げているか</li>
<li>田: フリークアウトさんで熱いのは？</li>
<li>明: DSP。プライベートDMP。パブリックDMP。ネイティブアド
<ul>
<li>まだ新しいし、取り組んでいる。</li>
<li>ネイティブアドは激戦区に</li>
<li>DSPの配信のエンジンはどこまでも進化させられる</li>
</ul></li>
<li>田: 1. DMPの取り組みを増やしてインプットを増やす
<ul>
<li><ol start="2" style="list-style-type: decimal">
<li>集めてきたデータの最適化</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>ロジックの高速化</li>
</ol></li>
<li>はてなで熱いのは、 3. の部分</li>
</ul></li>
<li>明: フリークアウトでは 2. に力を入れている
<ul>
<li>100ms縛りはある。「50ms or die」</li>
<li>50ms でどこまで高度な計算の近似値を出せるか</li>
</ul></li>
<li>田: CPUの改善の頭打ち
<ul>
<li>FPGAとかで改善があつかったり。やってらっしゃいます？</li>
</ul></li>
<li>明: まだそこに踏み切れてない
<ul>
<li>踏み切った次点で一番最適な技術を選択するのがよい</li>
</ul></li>
<li>田: 計算量のチューニングはしている？</li>
<li>明: している。50msはすぐ過ぎてしまう
<ul>
<li>アドベリの精度を上げるためにやっていることは？</li>
</ul></li>
<li>田: クラス分け問題のアルゴリズムを色々試している
<ul>
<li>モダンなアルゴリズムを探っている</li>
</ul></li>
<li>明: FPGAとかはどう？</li>
<li>田: はてなは今はバッチ処理している
<ul>
<li>FPGAでガリガリチューニングするよりアルゴリズムを</li>
<li>チューニングすることは多いけど、さすがにFPGAは持ち出してない</li>
</ul></li>
<li>明: 他にも使い切るべき技術はあるので、FPGAにはまだフラットな立場
<ul>
<li>他社の話を聞くとやってみたいなとは思う</li>
<li>原則は現場に任せている</li>
</ul></li>
<li>田: プライベートDMPとか、大規模データはけっこう大変では？</li>
<li>明: 仕組みがシンプルなので正規化とかはしてない
<ul>
<li>クラスタリング的な手法は多少使っている</li>
<li>KVSを箱としては利用している</li>
<li>TTを使っているが、限界を感じて他を考えている</li>
<li>Hadoop、 elastic search など</li>
</ul></li>
<li>田: TokyoTyrantのこと？ いろいろな思いがある</li>
<li>明: なぜ苦笑い？</li>
<li>田: 昔使い潰した。限界近いときの挙動に問題があって苦労した</li>
<li>田: 実装言語は考えていきたい。Perlでアルゴリズムを実装するのにはいいのか
<ul>
<li>WEB向けのライブラリは多い。アルゴリズム系のライブラリはどう？</li>
<li>計算機科学とか。PythonとかRも使っていきたい</li>
</ul></li>
<li>明: うちもPerlがメイン。
<ul>
<li>データマイニングではPython、Hadoopも使っている</li>
<li>今後計算量が増えた時にPerlが最適化</li>
</ul></li>
<li>田: どこに注目？</li>
<li>明: Perl系の人はgo。UIを作ってる人はRubyを見たり</li>
<li>田: 今はPerl？</li>
<li>明: 表に出しているところは全部Perl
<ul>
<li>Perlに苦手な処理からは逃げているので、まだ大丈夫a</li>
</ul></li>
<li>田: Perlは採用は大変では</li>
<li>明: 言語はツールなのでなんでもよい。テクノロジに興味を持ってもらうように話す</li>
<li>田: 基本、採用の時はPerl書くよという。Scalaとかは採用している
<ul>
<li>B2Bだと静的片付けはデグレが少なかったりいい</li>
<li>言語を増やしすぎるとカオスになるのは避けたい</li>
</ul></li>
<li>明: 人事には「Perl変わらない？」と言われる
<ul>
<li>人事に言われる筋合いではない</li>
<li>現段階ではPerlの生産性が高い</li>
</ul></li>
<li>Q. 欲しいエンジニア像は？</li>
<li>田: B2Bに手を出して、求める幅が広がっている
<ul>
<li>アプリを作ったり</li>
<li>より幅広い人を求めている</li>
<li>時代の要請にあった技術を身につけられる人</li>
</ul></li>
<li>明: アドテクの業界に興味がある人
<ul>
<li>勉強を惜しまない人。日々変わっていく</li>
<li>ある領域にとんがっている人。追求できる人</li>
<li>アイデアを人に伝えることができる人。文系と理系の人を取り持つ人</li>
<li>データを扱える人たちは貴重。力を入れている。</li>
</ul></li>
<li>Q. 機械学習でアドテクの未来が変わっていく。どう関わっていくか</li>
<li>明: 今はバッチ的な機械学習が多い
<ul>
<li>リアルタイムになっていく</li>
<li>ムーアの法則の崩壊。近似値を出すような特殊な取り組みが求められる</li>
<li>より高度なアルゴリズムの簡略化</li>
</ul></li>
<li>田: 教師付きの機械学習には限界がある
<ul>
<li>コンテキストを理解するようなアルゴリズムを探りたい</li>
<li>人間と似たような判断ができるような</li>
<li>現在の広告の価値を変えるようなアルゴリズム</li>
</ul></li>
<li>明: 教師なしアルゴリズムは結構トライされている。方向性はある？</li>
<li>田: 論文はサーベイしているけど、まだ時間は掛かりそう
<ul>
<li>取り組む価値は出てくる</li>
</ul></li>
<li>Q. AWSのサービスをどうつかう？kinesisとか使ってる？</li>
<li>田: 全部オンプレ。はてなブックマーク(古い)と蜜結合なので
<ul>
<li>kinesisとかredshiftをがりがりは使ってない</li>
<li>はてなブログなどで使ったりはしている</li>
<li>mackerel使おう！</li>
</ul></li>
<li>明: 規模が大きくなるとコスト高になる
<ul>
<li>事業規模が大きくなった次点でオンプレにしている</li>
<li>海外サービスではネットワーク距離の問題もあってAWSを利用</li>
<li>AWSの様々な機能を使っているかといえば、そうでもない</li>
</ul></li>
</ul>
<h2 id="フリークアウトにおける大規模データの取り扱いのこれまでとこれから-加藤さん">フリークアウトにおける大規模データの取り扱いのこれまでとこれから / 加藤さん</h2>
<ul>
<li>RTBの仕組みについて
<ul>
<li>ユーザ → SSP → 応札！ → 最高値が勝</li>
<li>アプリの中は 50ms or die</li>
</ul></li>
<li>大規模データは２つ
<ul>
<li>オーディエンスデータ</li>
<li>配信ログ</li>
</ul></li>
<li>オーディエンス = 広告を見ている人
<ul>
<li>広告の接触、セグメント、クリック履歴など</li>
<li>数十億データ</li>
<li>日本の人口を超えているが、1人 1 IDではないので</li>
</ul></li>
<li>オーディエンスデータを使うところ
<ul>
<li>最適な広告をオーディエンスデータから判断する(50ms)</li>
<li>memcached + KVSの二重構成</li>
<li>KVSは0.1ms〜数ms。3TBくらい</li>
<li>15000 get/s</li>
</ul></li>
<li>Tokyo Tyrant使ってる。速い
<ul>
<li>Expireできない</li>
<li>consistent hashingはしているがサーバ追加するとロストが出る</li>
</ul></li>
<li>OKAWARI作戦
<ul>
<li>新しいTTを前段に用意</li>
<li>旧から新に徐々に書き換えていく</li>
<li>旧を外す</li>
<li>サーバ台数がすごいかかるので効率悪</li>
<li>退役できるのは以降がすんでから</li>
</ul></li>
<li>riak → 断念
<ul>
<li>writeが厳しいため断念</li>
<li>OKAWARIに戻った</li>
</ul></li>
<li>HBASEを使うことを検討中
<ul>
<li>書き込み性能が高い。スケーラビリティ</li>
<li>もう火山じゃなくなってる（ほんと？）</li>
<li>HBase 0.98.6を検証中</li>
<li>手前にラッパーAPIを準備。APIはmessage packで</li>
<li>うまくいったらまた別途報告を！</li>
</ul></li>
<li>配信ログ
<ul>
<li>クリック、コンバージョンなど</li>
<li>配信実績の分析。ABテストの実施</li>
<li>オーディエンスデータのデモグラ分析</li>
<li>開発側で使う指標の測定など</li>
</ul></li>
<li>大昔 → MySQL
<ul>
<li>2013年半ばからHive</li>
<li>Elastic search + KIBANA体制</li>
<li>Impara導入、fluentdの監視でNorikra</li>
</ul></li>
<li>CDH4 →CDH5
<ul>
<li>Yarn対応。Cloudera Manager</li>
<li>Hadoopエコシステムの進歩の速さについていくため採用</li>
</ul></li>
<li>Hivemall → 機械学習</li>
<li>Impara → バク速Hive</li>
<li>Norikra → metricsの収集</li>
<li>Elasticsearch + Kibana → サマリの可視化
<ul>
<li>kibanaじゃない別UIも作ってある</li>
</ul></li>
<li>Spark使いたい(MLlibも)
<ul>
<li>HBaseも</li>
<li>日次バッチから分次バッチへ</li>
<li>開発側に訴えかける可視化
<ul>
<li>パフォーマンスや使ってるリソースなど</li>
<li>あなたのコミットが何の役に立ったか</li>
</ul></li>
</ul></li>
</ul>
<h2 id="brandsafe-はてなのアドベリフィケーションのしくみ-伊奈さん">『BrandSafe はてな』のアドベリフィケーションのしくみ / 伊奈さん</h2>
<ul>
<li>インターンの時にはてなブックマークをやってた</li>
<li>検索技術を多くやってた → 専門はtyp theory</li>
<li>brandsafe はてな
<ul>
<li>広告主の希望で、リクエストを出すべき、出さないべきを判断</li>
<li>2chまとめサイトに出さない、の機能は人気がある</li>
<li>違法ダウンロードサイトに出さない、など</li>
</ul></li>
<li>Webページの分類問題
<ul>
<li>2chまとめかつアダルト、もある → 各属性について2値分類</li>
</ul></li>
<li>判定方法の候補
<ul>
<li>人間が手動で →十分 高速にできるのであれば、これでもいい</li>
<li>ルールベース、機械学習</li>
<li>工数を抑える。計算量を抑える。保守性をキープ</li>
</ul></li>
<li>はてなブックマークの仕組み
<ul>
<li>ブックマーク→本部う抽出→メタ情報抽出→カテゴリ判定、アドべり判定</li>
<li>トリガをはてなブックマーク以外でもできるようにする</li>
</ul></li>
<li>素朴なフィルタの例
<ul>
<li>NGワードがあれば、という判定</li>
<li>メンテナンスが簡単(単語をリストに追加していくだけ)</li>
<li>リンク数を見る、とか</li>
<li>精度は低い</li>
<li>「カブトムシの交尾」「やまもとい“ちろう”」問題</li>
</ul></li>
<li>素朴なフィルタをたくさん重ねる
<ul>
<li>一つのフィルタだと誤認識が</li>
<li>2次元にすると、綺麗に分かれる可能性もある</li>
<li>直線 ax+by+c を引く</li>
<li>aとbを設定</li>
</ul></li>
<li>直線を手でチューニングするのはちょっと
<ul>
<li>可能であればそれでもいい(地域別エントリはそうしてる)</li>
</ul></li>
<li>AdaBoost
<ul>
<li>弱分類気を複数合わせる</li>
<li>2個目以降のフィルタの学習は、それまでの判定が誤っていたもののデータを重くする</li>
</ul></li>
<li>BSはてなの弱分類器
<ul>
<li>カテゴリの偏り、タグの頻度、特定タグ、コメント率</li>
<li>他、ブックマークしてなくてもできるもの → URL、キーワードの出現</li>
</ul></li>
<li>キーワードの出現傾向、の精度を上げる
<ul>
<li>Perceptron 教科書に載ってる。枯れてる</li>
<li>単語の出現ベクトルと作って、それで学習</li>
<li>誤った場合は、ウェイトを入力データで学習</li>
<li>Perlで20行程度のコードで精度がかなり出た</li>
</ul></li>
<li>教師データを集めるのが大変
<ul>
<li>URLを人の目で判断</li>
<li>人なのでぶれが出る</li>
</ul></li>
<li>AdaBoost
<ul>
<li>スパムフィルタ用途だった</li>
<li>AdaGrad + RDA・・・はいいはずなのに、検証したらよくなかった</li>
</ul></li>
<li>Perceptronはすごくうまくいった
<ul>
<li>キーワードを増やすときつい</li>
<li>特徴語に絞っているのがGood</li>
</ul></li>
<li>今後
<ul>
<li>判定できる属性を増やす、画像対応、フィルタリング以外に使う(積極的に広告を出すとか)、次元をふやす(100億くらい)</li>
</ul></li>
<li>東京でも京都でも勤務可能!</li>
</ul>
<h2 id="ゼロから始めたgunosyのアドサーバ開発運用記-粟飯原-さん">ゼロから始めたGunosyのアドサーバ開発運用記 /  粟飯原 さん</h2>
<ul>
<li>「本当に怖いこの一年で踏みぬいたアドサーバ地雷の話」
<ul>
<li>Gnosy Ads</li>
<li>完全自社製。Python製。Scalaとgoも</li>
<li>End to EndのRTB</li>
<li>アドネットワークも</li>
</ul></li>
<li>アドサーバは総合格闘技
<ul>
<li>アルゴリズム、大規模データ、安定、高速</li>
</ul></li>
<li>配信エンジニア2名(入稿システムは別)
<ul>
<li>AWSを活用。自動化。プロビジョニング。</li>
<li>サーバふやすよりチューニング</li>
<li>KPI Tool (数値は神より正しい)</li>
</ul></li>
<li>ユーザ数が10倍、配信料は数千倍
<ul>
<li>エンジニア数は5倍</li>
</ul></li>
<li>最初はTornado性の数台のサーバ
<ul>
<li>オンライン学習＋バンディット (思い計算)</li>
<li>RDBは一切見ず、redis</li>
<li>hっログはagentでMongo DBへ</li>
</ul></li>
<li>スパイキーなアクセスが捌けない
<ul>
<li>サーバと同時にエンジニアも死ぬ</li>
<li>CPUバインド。サーバを横にふやす</li>
<li>APIサーバで計算するのが間違い→バッチ系へ</li>
<li>トラブルが楽しい時期→比較的カジュアルにサービスをいじる</li>
</ul></li>
<li>ウルトラマンのCMで広告枠増
<ul>
<li>収益も増えた→止められないサービスへ</li>
<li>redisに載り切らない。詰まる。</li>
<li>S3経由で全サーバにデータをばらまく対策</li>
<li>垂直分散</li>
<li>riakはコスト面で不採用</li>
</ul></li>
<li>Redshiftへ以降。楽できる・・・はずだった
<ul>
<li>データの爆発でRedshiftが死亡</li>
<li>バッチはPythonのCeleryで分散処理</li>
</ul></li>
<li>Redshiftはテーブルがメモリに乗らないと使い物にならない
<ul>
<li>お金持ち以外は厳しい</li>
<li>メモリに乗らないビッグデータは諦める。データマートとしての利用</li>
<li>定時バッチに必要なものだけ載せる</li>
<li>アドホックな分析、回帰モデル構築はSparkを利用</li>
<li>全ログ集計はImparaへ</li>
</ul></li>
<li>Pushのアルゴリズム改良で開封率が上がりすぎた
<ul>
<li>1分以内に大量アクセスが来るように。20倍！</li>
<li>ELBから外されるレベルで配信が死ぬ</li>
<li>Redisと完全にサヨナラしたいけど厳しい</li>
</ul></li>
<li>夢の技術なんてない
<ul>
<li>BigQueryに期待</li>
<li>インフラは全部自動化したい</li>
<li>いろいろな経験がつめてよい</li>
</ul></li>
</ul>
<h2 id="the-technology-behind-m.t.burn-久森さん">The technology behind M.T.Burn / 久森さん</h2>
<ul>
<li>M.T.Burn → AppDaviを作ってる</li>
<li>言語
<ul>
<li>Objective-C</li>
<li>Java, roboletric</li>
<li>Perl → 経験者が多い</li>
<li>JS 一択</li>
</ul></li>
<li>サーバサイド
<ul>
<li>AWS。AutoScaling 自分たちでは運用しない</li>
<li>EC2インスタンスだけを面倒見るように</li>
<li>Ubuntu 14.04ベース → 新しいパッケージを使いたい</li>
<li>PackerでAMI Imageを</li>
<li>Docker → ワークロードがそこまで上がらないサーバにはいい
<ul>
<li>デベロッパが出元でDocker build</li>
<li>S3へ。インスタンスがpull</li>
</ul></li>
<li>Fluentd : Norikra, mackerel</li>
</ul></li>
<li>Mackerel → サービスの監視。サービスメトリクスとして任意のものも
<ul>
<li>サーバインスタンスが増えたり減ったりする環境だといい</li>
<li>AutoScalingしてもグラフが途切れない</li>
</ul></li>
<li>Norikra → Docker image あるよ
<ul>
<li>例: imp, click, conversionを分単位で</li>
</ul></li>
<li>BigQueryを採用
<ul>
<li>UIの操作ログも。バッチの実行ログも</li>
<li>とにかく何でも</li>
<li>ストレージが安い、運用しなくていい。開発速度が上がる</li>
</ul></li>
<li>Development Tool
<ul>
<li>github : コードとissue。PR駆動</li>
<li>TravisCI の有料プラン iOS, Android, Perl, JS</li>
<li>Qiita Team → 日報や技術情報</li>
<li>Slack → チャット。アラートとかも
<ul>
<li>Mackerel - Slack 連携</li>
<li>メールには頼らない</li>
</ul></li>
</ul></li>
<li>利用者、メディアが急激に伸びている</li>
<li>3回作り直している
<ul>
<li>オンプレ→クラウド、セルフ→マネージド</li>
</ul></li>
<li>使わなくなったもの
<ul>
<li>オンプレ → 調達が大変。スケールを破壊的にしたいので。</li>
<li>内部DNS →Route53</li>
<li>CentOS → 古い</li>
<li>Cobbler。Cloud-init + AMI</li>
<li>rsync → S3へ。syncさせる。Auto scalingの際にも安全</li>
<li>Puppet→Ansible→shellへ。ロールあたりのやることが少なくなったので</li>
<li>Nagios, CloudForecast → サーバリストが多く、管理につかれた</li>
<li>HipChat → クラッシュ、API連携がきつい</li>
<li>Hive, MapReduce → 開発者がコントロールできることをふやす。BigQueryはredshiftより手間が少なくて安い</li>
</ul></li>
<li>重要なこと
<ul>
<li>マーケット、テクノロジーについてキャッチアップ</li>
<li>トレンドの変化に強い構成が重要</li>
<li>スケーラブルで、かつ、オペレーションを減らすこと</li>
</ul></li>
<li>常にアップストリームを追う姿勢が大切</li>
</ul>
</p>

</div>



<div>
  <h1>今はまだtransformers 0.3のサポートが必要</h1>
<div class="post-info">
    Posted on <a href="./posts/2014-12-14-DependencyMaintenance.html">December 14, 2014</a>
    <!-- facebook button -->
    <div class="fb-like" data-href="http://hiratara.github.io/posts/2014-12-14-DependencyMaintenance.html" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
    <!-- Twitter button -->
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://hiratara.github.io/posts/2014-12-14-DependencyMaintenance.html" data-text="今はまだtransformers 0.3のサポートが必要" data-via="hiratara">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</div>
<p>
    <p><a href="https://t.co/fjxbuYP8jz">GHC 7.8, transformers 0.3, and lenient lower bounds</a>に書いてあるとおりの話。</p>
<p><a href="https://github.com/hiratara/lambdabot-hipchat-plugins">lmabdabot-hipchat-plugins</a>で<a href="https://hackage.haskell.org/package/pontarius-xmpp">pontarius-xmpp</a>使ってるんだけど、hh変更が多いライブラリなのでgithubのmasterからビルドしようと思ったらハマった。hackageに<a href="https://github.com/pontarius/pontarius-xmpp/commit/730b3ce61a93c1fa0a">上がってないcommit</a>がtransformer 0.4へ依存し始めたため、先に貼ったリンクの問題でビルドができない。</p>
<p>具体的には、lambdabotが依存しているmuevalがghcに依存しているためにtransformer 0.3縛りがあるために、以下のエラーが出る。</p>
<pre><code>% cabal install -p --only-dependencies --ghc-options=&quot;-O2 -threaded -fprof-auto&quot; -j
Resolving dependencies...
cabal: Could not resolve dependencies:
trying: lambdabot-5.0 (user goal)
trying: lambdabot-hipchat-plugins-0.1.0.0 (dependency of lambdabot-5.0)
next goal: transformers (dependency of lambdabot-hipchat-plugins-0.1.0.0)
rejecting: transformers-0.3.0.0/installed-16a... (conflict: pontarius-xmpp =&gt;
transformers&gt;=0.4)
trying: transformers-0.4.2.0
trying: lambdabot-haskell-plugins-5.0 (dependency of lambdabot-5.0)
trying: mueval-0.9.1.1 (dependency of lambdabot-haskell-plugins-5.0)
trying: hint-0.4.2.1 (dependency of mueval-0.9.1.1)
next goal: ghc (dependency of hint-0.4.2.1)
rejecting: ghc-7.8.3/installed-4d8... (conflict: transformers==0.4.2.0, ghc =&gt;
transformers==0.3.0.0/installed-16a...)
Backjump limit reached (change with --max-backjumps).

Note: when using a sandbox, all packages are required to have consistent
dependencies. Try reinstalling/unregistering the offending packages or
recreating the sandbox.</code></pre>
<p>対策としては、pontarius-xmpp側を再度transformer 0.3に対応させるしかないのかなーと思ってる。</p>
</p>

</div>



<div>
  <h1>今日は「アドテク×Scala meetup」の日です</h1>
<div class="post-info">
    Posted on <a href="./posts/2014-11-20-AdtechScala.html">November 20, 2014</a>
    <!-- facebook button -->
    <div class="fb-like" data-href="http://hiratara.github.io/posts/2014-11-20-AdtechScala.html" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
    <!-- Twitter button -->
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://hiratara.github.io/posts/2014-11-20-AdtechScala.html" data-text="今日は「アドテク×Scala meetup」の日です" data-via="hiratara">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</div>
<p>
    <p><a href="http://connpass.com/event/8384/">アドテク×Scala meetup</a>へ来ているので、内容を適当にメモっておく。タグは<a href="https://twitter.com/search?q=%23adtech_scala">#adtech_scala</a>とのこと。</p>
<h2 id="挨拶-田村さん">挨拶 / 田村さん</h2>
<ul>
<li>前半はプレゼン、後半はパネルディスカッション</li>
<li>飲み物と寿司あるよ！</li>
<li>スピーカー紹介</li>
</ul>
<h2 id="アドテクを支えるscala---ad-generationの場合野村欣弘さん">「アドテクを支えるScala - Ad Generationの場合」野村欣弘さん</h2>
<ul>
<li>Scalaは1.5年、ネット広告業界は2.5年
<ul>
<li>medibaさんの前もSSP</li>
</ul></li>
<li>なぜScalaを使い始めたか
<ul>
<li>medibaの求人ではScalaについて触れてない。けど使ってる</li>
<li>2011年くらいから Lift を使ってた形跡。それがスタート</li>
<li>Lift押しの人はもう在籍していない・・・</li>
<li>その後Play × Spark</li>
</ul></li>
<li>Ad Generation → スマホに注力したSSP
<ul>
<li>ScaleOutに譲渡予定</li>
<li>ScalaはRTBに使ってる</li>
</ul></li>
<li>流れ
<ul>
<li>SDK → 枠データ参照(RTBかどうか)→RTBサーバ(Scala)→DSP</li>
<li>DSPからのレスは100ms待つ。オークションを実施。高いものをadserverへ返す</li>
<li>戻すものがなければ adnetwork のタグを戻す</li>
<li>ログはfluentd → HDFS → ログ集計(scala)</li>
</ul></li>
<li>rtb-engineはspray (akkaベース。軽量で速い)
<ul>
<li>UIもsprayで実装</li>
<li>70億オークション/月。250(70×3〜4DSP)億bidリクエスト/月</li>
<li>対アドサーバは4,900qps、対DSPは20,000QPS</li>
<li>リソースはまだ余裕ある</li>
</ul></li>
<li>ピーク時にさばけないことがあったので、チューニングした
<ul>
<li>akkaとsprayの設定を見直し。似たような設定項目があって、戸惑う</li>
<li>ベンチをとりながら調整</li>
</ul></li>
<li>コードの見直し
<ul>
<li>ブロックを防ぐためにFutureを利用</li>
<li>スレッドプールを用途ごとに用意 : アドサーバ、DSP、Future、ログ出力、など</li>
</ul></li>
<li>rtb-engine-log
<ul>
<li>sparkを利用。Pythonとかでも書けるけどScalaで</li>
<li>mesos上で実行 : sparkと相性がいいので</li>
<li>7種のログ(オークション関連は4種類)</li>
<li>cronで10分、1時間、1日の粒度</li>
<li>HDFSから読んでPostgressに吐き出し</li>
<li>cron → spark → mesos master → zoo keeper に登録してあるワーカへ</li>
<li>6CPU、20GB を 4台。(master 2、slave 4)</li>
<li>ログの量 500MB〜1.5GB / hour。配信は10台。</li>
<li>12s 〜 40s / job</li>
</ul></li>
<li>spark を使った感想 → 不満はない
<ul>
<li>メモリに乗せると速いけど、乗せすぎるのもよくないという印象</li>
<li>処理が30分で終わるけど、JVMの停止に30分かかるとか</li>
<li>手軽。身構えなくていい。spark-shellがあったり、コレクション操作する感覚だったり</li>
</ul></li>
<li>scalaを使った感想
<ul>
<li>並列、並行処理を使いやすい</li>
<li>アドサーバやRTBサーバには向いている</li>
<li>用途を選ばず使える。JVMなんで。一種類の言語に統一できていい</li>
<li>Javaは知っておいたほうが</li>
<li>チューニングには、JVMのパラメータとか知らないと</li>
</ul></li>
<li>今後の課題
<ul>
<li>チューニングはこのあと誰かがやるよ！</li>
<li>分析などに使えるのを調べたい</li>
</ul></li>
<li>Pのつく言語につかれた方はぜひいらしてください</li>
</ul>
<h2 id="dynalyst-scala-culture韓翔元さん">「Dynalyst Scala {Culture})」韓翔元さん</h2>
<ul>
<li>ノートとかメモっておいたけど消えたのでアドリブで</li>
<li>Javaは8年、Scalaは1年</li>
<li>Dynalyst “Dynamic Retargeting + Analyst”
<ul>
<li>スマホに特化したリターゲティング</li>
<li>Scala 88.7%(前は90%あったんだけど・・・)、Rubyが9.6%</li>
</ul></li>
<li>bid, ad, 計測サーバは spray。その裏にakka。ログはredshiftへ
<ul>
<li>ログの最終形はakka(bidの最適化など)</li>
</ul></li>
<li>sprayの理由
<ul>
<li>ドキュメントが充実</li>
<li>テストキットがいい</li>
<li>ベンチマークも良い</li>
<li>Scalaを使いたかった</li>
</ul></li>
<li>並行性 → 16コアを使い切れてる</li>
<li>ExecutionContext(どのスレッドで実行するか)、Future。for記法使える</li>
<li>spray-routing(他にspray-httpとかもある)
<ul>
<li>DSLっぽく見やすく書ける</li>
<li><code>FutureDirectives</code>。akkaのthreadをブロッキングしない</li>
<li><code>onComplete</code>で実装させて、<code>Success</code>と<code>Failure</code>でパターンマッチ(failureはno bid)</li>
<li><code>Future[A&lt;:BidResponse]</code></li>
</ul></li>
<li>ひとつのFutureにすべての計算を入れるのは良くない</li>
<li>Router, Logic, External Resourcesの3レイヤに分ける
<ul>
<li>スレッドをキックするディスパッチャが必要</li>
<li>3つ一緒でもいいし、レイヤごとでも(dynalystはレイヤごとに最適化)</li>
<li>レイヤのローカルスコープに、 <code>implicit val</code> で定義</li>
</ul></li>
<li>Futureのテスト → 別スレッドなので普通には無理
<ul>
<li>Specs2 を使う <code>Matcher[Future[T]]</code></li>
<li><code>.await</code> できる。リトライやタイムアウトも</li>
</ul></li>
<li>jenkinsを使っているが、CIのサイドエフェクトの影響でテスト落ちることが
<ul>
<li>再ビルド時間かかる。切り分け辛い</li>
<li>Abstract Future → <code>Monad[M]</code> にしておけばおｋ</li>
<li><code>Service</code> のコンパニオンで、<code>M</code>を<code>Future</code>にしたり<code>Id</code>にしたり</li>
<li>テストでは <code>Id</code> 、 本番では <code>Future</code></li>
</ul></li>
<li><code>Monad</code>とは → 構造。ステップごとに評価するもの。</li>
<li>akkaはakka.io読め
<ul>
<li>バッチではなくデーモンで動かしてる</li>
</ul></li>
<li>Master / Workerパターンを使う (letitcrash.comのポスト)
<ul>
<li>Master, Worker, Requester の3つのアクター</li>
<li>WorkerはMasterから仕事を受け取って、Futureで仕事をさせる(自分のスレッドはブロックしない)</li>
</ul></li>
<li>Akkaの監視の仕方
<ul>
<li>Typesafe Console
<ul>
<li>UIはいい。type safe社のサポート</li>
<li>値段が高いのでやめた</li>
</ul></li>
<li>Kamon
<ul>
<li>無料なのでこっち</li>
<li>Akka, Spray, Playをサポート</li>
<li>Mailボックスのたまり具合、スループットなどの監視</li>
<li>StatsD、New Relic, Datadog などで可視化</li>
<li>Migrationはけっこう大変(昨日コンパイルエラー出たのでpull-reqした)</li>
</ul></li>
</ul></li>
<li>Kamonとzabbixを連携
<ul>
<li>StatsDにzabbix統合を利用</li>
<li>ルータはスレッド使わない、DB周りはスレッド多い</li>
</ul></li>
<li>まとめ
<ul>
<li>SprayのFutureDirectiveを使ってる</li>
<li>Abstract Futureでテストしやすく</li>
<li>Akkaはmaster/worker パターンを使ってスケールできる構成</li>
<li>Kamonでモニタリング</li>
</ul></li>
<li>https://github.com/alexandru/scala-best-practices というのがある
<ul>
<li>学習コストが高いと言われることが多いので</li>
<li>“MUST NOT, SHOULD NOT” だらけ → Scala選ばない理由になりそう・・・</li>
<li>このページで勉強するといいんじゃね</li>
<li>トライアンドエラーを繰り返して、いいものを見つけるのがエンジニアのやることでしょう</li>
</ul></li>
</ul>
<h2 id="アドテクscalaパフォーマンスチューニング水谷陽介さん">「アドテク×Scala×パフォーマンスチューニング」水谷陽介さん</h2>
<ul>
<li>DSS Tech Blogってのがあるので見てね</li>
<li>DSPとは → SSPへ入札する</li>
<li>すべてのプロダクトでscalaを採用している
<ul>
<li>サーバサイド、webコンソール、バッチ</li>
</ul></li>
<li>パフォーマンスチューニングの目的
<ul>
<li>システムの課題の解消
<ul>
<li>甲府カジノ問題、レイテンシー、バッチ処理の時間超過、開発ツールの動作の遅さ</li>
</ul></li>
<li>インフラコストの削減
<ul>
<li>アドテクではコストが肥大化しがち</li>
<li>配信料による利益＞インフラ投資 を満たさないと</li>
</ul></li>
<li>パフォーマンスチューニングにもコスト・リスクはある→インフラ増強が一番の場合もあるので注意</li>
</ul></li>
<li>チューニングの仕方→メトリクス測定、ボトルネック特定、仮説を立てて調整</li>
<li>「80%の時間はコードの20%が占める」パレートの法則
<ul>
<li>半分くらいはデータベースが原因</li>
<li>次点は非同期・スレッド。Scalaの問題とか</li>
<li>正しい実装をしていればI/O bindになる</li>
</ul></li>
<li>I/O : メモリ、ディスク、ネットワーク
<ul>
<li>CPU命令を1回1秒とすると、メモリから読み込み3日, ディスク6.5ヶ月, レイテンシ5年</li>
</ul></li>
<li>10kbのファイルを100万個読んだ場合 → シーク2.5h 。1回のシークだと3.5msで済む</li>
<li>メモリ、処理量、応答速度は3すくみの関係
<ul>
<li>比重を変えるのがチューニング</li>
<li>面積を増やすのが最適化</li>
</ul></li>
<li>パフォーマンスチューニングは、性能要件について関係者の合意を得ることから
<ul>
<li>ブラウザ数、配信数の見積り</li>
<li>月間10億impだと、1000QPSくらいでしょう</li>
<li>トラッカーを受け取る量</li>
<li>集計するもの。誰が何を見るのか</li>
<li>ビジネスサイドの制約→年度内売上など</li>
<li>数字を出すのが大事。性能テストの目標とする</li>
</ul></li>
<li>並行プログラミングモデルの設計は重要
<ul>
<li>ブロッキングを減らす。FutureとActorを使うのか</li>
<li>スレッドプールのサイズは本番デプロイしないとわからない</li>
</ul></li>
<li>DB設計 : ルックアップ回数。レコードあたりのサイズとか。メモリ使用量。</li>
<li>最初の実装は簡潔さ、明快さを優先
<ul>
<li>線形より悪いアルゴリズムは避けること</li>
<li>推測するな、計測すべし</li>
<li>sbt-jmh マイクロベンチマークツール。<code>run</code>にオプション指定するだけ</li>
</ul></li>
<li>Scalaコードの最適化
<ul>
<li>コレクションを正しく使う</li>
<li>関数呼び出しより再帰を使うとオーバヘッドを防げる</li>
<li>例: <code>List#length</code> の計算量は <code>O(n)</code> でそれを <code>n</code> 回呼ぶようなコード</li>
<li>ScalaBlitz : Scalaコレクションの高速化 (マクロでごにょごにょ)</li>
</ul></li>
<li>性能テスト
<ul>
<li>シンプルであれば ab</li>
<li>Gatling → Scalaで書かれたテストツール</li>
<li>JMeterの時代は終わった！</li>
<li>負荷をかける側のリソースに注意</li>
<li>二箇所以上変更しない</li>
</ul></li>
<li>ログの記録、異常検知が大事
<ul>
<li>GCログを出す</li>
<li>JMX</li>
<li><code>/dev/null</code> に捨てない</li>
<li>SLF4J + Profiler どこの処理がボトルネックか</li>
<li>可視化 Grafana + Graphite : トレンドを見れる</li>
</ul></li>
<li>それでも行き詰まったら : C++</li>
</ul>
<h2 id="軽量言語メインの文系エンジニアだった自分がscalaのシステム開発に携わることになった経緯-重村道人shigemk2さん">「軽量言語メインの文系エンジニアだった自分がScalaのシステム開発に携わることになった経緯」 重村道人(<span class="citation">@shigemk2</span>)さん</h2>
<ul>
<li>文系だった。和民でバイトしながらRuby
<ul>
<li>フィリピンで英会話ごにょごにょ</li>
<li>ソシャゲ Pythonとか</li>
</ul></li>
<li>A8.net(2000-), moba8.net(2006-) → Java。tomcat。レガシー</li>
<li>トラッキングサーバがScala、Play</li>
<li>Github Enterprise を導入してつらい目にあったり</li>
<li>Scalaを採用した理由
<ul>
<li>レガシーのリプレイス。Javaからなら楽だろう</li>
<li>上司がScala好き (LiftでWebアプリ書くほど)</li>
<li>メンバーもScala好き (Scala Matsuriのスタッフが2名)</li>
<li>モナドや圏論が飛び交う職場。ScalaZ</li>
</ul></li>
<li>コンパイルが遅い対策
<ul>
<li>性能の良いLinuxマシン</li>
</ul></li>
<li>Javaの会社かと思ったらScalaだった
<ul>
<li>まったくわからん。「Javaでいうところの」がわからない</li>
<li>とりあえずブログを書く</li>
<li>わからなければ教えを請う (自分以外ほぼ全員が書ける)</li>
<li>月10,000円の書籍代(なれる！SEはNG)</li>
<li>Brainfuck方言を作ったり</li>
<li>LLとの共通点 : Rubyのオブジェクト指向。JSの関数型っぽさ</li>
<li>Scalaの本をたくさん読む (Google翻訳フル稼働で英語も)</li>
<li>F#でPDP-11のインタプリタを書いたり</li>
<li>8086の逆アセンブラをHaskellで書く</li>
<li>関数プログラミング実践入門、JavaScriptで学ぶ関数型プログラミング、とかとか</li>
</ul></li>
<li>「俺のScala道はこれからだ」</li>
<li>人が足りていないので募集しています</li>
</ul>
<h2 id="パネルディスカッション質疑応答など">パネルディスカッション(質疑応答など)</h2>
<ul>
<li>Q. JVMはスペックが必要で配信に向いてないのでは？</li>
<li>水. Scalaを選んだらたまたまJVMだった。できそうだったから</li>
<li>重. もともとJavaだった。資源を使える。Javaよりコード数が少ない</li>
<li>野. はじめからJVMだった。バケモノって感じではないのでカジュアルになった気がする
<ul>
<li>サーバスペックも上がってる。前職はApache × Perl、Erlang</li>
<li>前職40台くらいだったが10台くらいになった。akkaが軽量ぽい</li>
</ul></li>
<li>韓. Scala文化が広がっている。経験上、JVMでも2万QPSくらいさばけるのは知ってた。だからScalaも</li>
<li>Q. Haskell経験あるのでScalazを使いたくなる。どうしてる？</li>
<li>韓. Haskellは知らなかった。関数型をやるときはHaskellを避けられない。今のトレンドであり、悪いことではない</li>
<li>Q. 反対の声はあった？</li>
<li>韓. 心の中にはあるかもしれないけど聞いてない</li>
<li>水. どうやって勉強した？</li>
<li>韓. Functional programming in scalaを読んでる。scala baseの気になるセッションを見たり。みんなで勉強する文化を作った</li>
<li>Q. ログのフォーマットには何を採用？</li>
<li>Q. Scalaを使ってからプロダクトをリリースするまでの時間</li>
<li>野. LTSV。2〜3人で4ヶ月くらい。</li>
<li>韓. TSV。2〜3ヶ月くらい</li>
<li>重. トレジャーデータを使っているのでCSV。6ヶ月〜1年くらいのスパン</li>
<li>水. redshiftを使っているのでJSON。圧縮がいいものはmessage pack。2〜3ヶ月でプロトタイプ、ロンチは半年</li>
<li>Q. LLが恋しくなることは？</li>
<li>重. コードを書くことが恋しい。なんでもいい(から書きたい)</li>
<li>Q. フレームワークの選定基準は？</li>
<li>野. 理由は、速そうだから。深い理由はない。ベンチはとった。速度が重要</li>
<li>韓. type safe社のライブラリを使いたかった</li>
<li>水. 個人的にはフレームワーク使いたいが、ノウハウがない。スケジュールがタイト。手慣れたものを使った</li>
<li>重. Railsを使ってるとこもある。言語に対する好み。CakeかRails使います</li>
<li>麻. コロッサス？という「軽量NIOフレームワークが出てたよね</li>
<li>Q. Scalaと機械学習</li>
<li>水. 機械学習メインではない。Javaのlib linearとか使ってる</li>
<li>会場でScalaで機械学習やってる人は？ → いない</li>
<li>Q. Scalaを採用して難しかったことは？</li>
<li>韓. DIの解決が難しい。cake patternとか。むずかしかったのでやめた</li>
<li>水. 個人のレベル差。Scalaは個人の力が出やすい。ペアプロで意見があわなかったり。チームの底上げが難しい</li>
<li>克服するための社内での取り組みは？</li>
<li>水. 逆に知りたい。スカラのテストをするだけでも奥が深い</li>
<li>「複雑・・・高機能な言語」</li>
<li>韓. チームメンバーがもともとよかった。ペアプロ、勉強会</li>
<li>Q. Scalaエンジニアの採用が難しい。RubyとJava、どちらのエンジニアが向いてる？</li>
<li>重. Javaの人が市場に多いので、多い。Rubyの人は一人だけ。もともとJavaを使ってたのもある。言語関係なくエンジニアのレベルの高さによる</li>
<li>水. PHPのエンジニアもいるけど、習得速かった</li>
<li>韓. 最初からScalaの人が来たらラッキー。モチベーション、言語に対する理解は大事。Javaの理解は役に立つ</li>
<li>野. 募集はJavaエンジニアのほうが多い。Javaやってたほうが慣れるのは速そう。いミュータブルではハマるかも。クロージャとかで悩んだり</li>
<li>麻. 多くの言語を習得している人のほうが習得が早いという発表も前にあった</li>
<li>Q. sparkを使ってハマったことは？</li>
<li>野. HDFSとかでハマることのほうが多い。sparkはいいと思ってる</li>
<li>韓. 特にハマったことは聞いてない。「がんばりました」くらいの報告</li>
<li>麻. コミッタが来てた。twitterの</li>
<li>Q. アドテク</li>
<li>韓. 今のところはない。adrollという会社の話によると、海外ではerlangを使ってることが多いらしい。選択肢の一つかも</li>
<li>韓. 他のプロダクトでは、goでやるという決断をしたところもある</li>
<li>水. Apache, enginx の中で処理するときはCで書いている会社もあると聞いた。FPGAでのプログラミングも</li>
<li>Q. スレッドプールを分けることでどのような問題が解決されたのか？</li>
<li>韓. 特に問題はなかった。早く終わるfutureもあれば、時間がかかるのもある。プールが枯渇したりする。どのレイヤが時間がかかるか見にくかったのが見やすくなった</li>
<li>Q. スレッドプールを分けると監視がしやすかった？</li>
<li>韓. わかりやすくなった</li>
<li>Q. コーディング規約は？</li>
<li>全員コーディング規約は無さそう。書きたいように書いてそう。</li>
<li>重. scalaリフォームはいれている。明文化はしていない</li>
<li>麻. Rubyの人とJavaの人のコードが結構違うので、あえてもたないことも多いと聞いている</li>
<li>Q. Scalaの言語仕様の更新頻度とかどうなんでしょう？</li>
<li>水. Javaより更新スピード早い。後方互換もなくなることある。新しいものはその時点の最新版。ハマったら解決。</li>
<li>重. Playはバージョンアップ早い。2.3からアクティベータによって起動方法が変わったり。リプレースは辛そう</li>
</ul>
</p>

</div>



<p>…or you can find more in the <a href="./archive.html">archives</a>.

      </div>
    </div>
    <div id="content_footer"></div>
    <div id="footer">
      <p><a href="./">Home</a> | <a href="./about.html">About</a> | <a href="./contact.html">Contact</a> | <a href="./archive.html">Archive</a></p>
      <p>Copyright &copy; hiratara | <a href="http://validator.w3.org/check?uri=referer">HTML5</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> | <a href="http://www.html5webtemplates.co.uk">Free CSS Templates</a> | <a href="http://jaspervdj.be/hakyll">Hakyll</a></p>
    </div>
  </div>
</body>
</html>
