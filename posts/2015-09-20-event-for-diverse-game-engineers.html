<!DOCTYPE HTML>
<html>

<head>
  <title>Born in Tomakomai city - 今日は「Event for Diverse Game Engineers」の日です</title>
  <meta name="description" content="A blog for programmer" />
  <meta name="keywords" content="perl,haskell,mathematics" />
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <link rel="stylesheet" type="text/css" href="../css/style.css" />
        
        <!-- Google Analytics tracking codes -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-7637699-4', 'hiratara.github.io');
          ga('send', 'pageview');

        </script>
</head>

<body>
        <!-- facebook SDK -->
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=100848266724416";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
  <div id="main">
    <div id="header">
      <div id="logo">
        <div id="logo_text">
          <h1><a href="../">Born in <span class="logo_colour">Tomakomai</span> city</a></h1>
          <h2>A programmer who loves mathematics</h2>
        </div>
      </div>
      <div id="menubar">
        <ul id="menu">
          <li><a href="../">Home</a></li>
          <li><a href="../about.html">About</a></li>
          <li><a href="../contact.html">Contact</a></li>
          <li><a href="../archive.html">Archive</a></li>
        </ul>
      </div>
    </div>
    <div id="content_header"></div>
    <div id="site_content">
      <div class="sidebar">
        <h3>Links</h3>
        <ul>
          <li><a href="https://github.com/hiratara">hiratara@github</a></li>
          <li><a href="http://d.hatena.ne.jp/hiratara">hiratara@hatena</a></li>
          <li><a href="http://hiratara.dyndns.org/chaberi">Chaberi Backdoor</a></li>
        </ul>
      </div>
      <div id="content">
        <h1>今日は「Event for Diverse Game Engineers」の日です</h1>
<div class="post-info">
    Posted on <a href="../posts/2015-09-20-event-for-diverse-game-engineers.html">September 20, 2015</a>
    <!-- facebook button -->
    <div class="fb-like" data-href="http://hiratara.github.io/posts/2015-09-20-event-for-diverse-game-engineers.html" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
    <!-- Twitter button -->
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://hiratara.github.io/posts/2015-09-20-event-for-diverse-game-engineers.html" data-text="今日は「Event for Diverse Game Engineers」の日です" data-via="hiratara">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</div>
<p>
    <p><a href="http://ptix.co/1RSusta">Event for Diverse Game Engineers</a> に参加しています。 有料イベントですが全トークソーシャルO.K.のようなので、自分用のメモを残しておきます。 ハッシュタグは <a href="https://twitter.com/search?q=%23TokyoEDGE2015">#TokyoEDGE2015</a> です。</p>
<h2 id="mio_11-さん-思い描いてるものを形にするための事前準備">@4_mio_11 さん 「思い描いてるものを形にするための事前準備」</h2>
<ul>
<li>注意事項など</li>
<li>スクエニ本社に行きたい、大きい勉強会、そこで話したい</li>
<li>東京旅行のついでに <span class="citation">@tsuchidasama</span> さんにあって勉強会開こうと思った</li>
<li>80人くらいかと思ったら170人超え</li>
<li>「行動あるのみ」</li>
<li><span class="citation">@tsuchidasama</span> さんにFBで申請した</li>
<li>自分の環境を変化させてみよう</li>
<li>本物のゲーム開発者に触れるといいでしょう</li>
</ul>
<h2 id="dada246-さん-shared_ptrとゲームプログラミングでのメモリ管理"><span class="citation">@DADA246</span> さん 「shared_ptrとゲームプログラミングでのメモリ管理」</h2>
<ul>
<li>眠くなる話で眠らせていく予定</li>
<li>OSは動いていること前提。C++ネイティブ。アクションゲームなどリアルタイム性。中規模～(50人以上)</li>
<li>ゲームプログラム
<ul>
<li>FPSが安定</li>
<li>(メモリの観点で)スワップアウトが発生しない</li>
<li>実行時のメモリが物理メモリサイズに収まる</li>
</ul></li>
<li>メモリ固定管理: ゲーム中はOSからメモリをもらわない
<ul>
<li>動的管理: 必要になったらメモリを返却する</li>
<li>今回は後者</li>
</ul></li>
<li>近年データ量が増えている。データドリブンである必要</li>
<li>メモリを動的管理にすることで制限が減る</li>
<li>多彩なデータを扱えると、デザイナやアーティストが思いついたアイデアを試行錯誤できる</li>
<li>「一時的にメモリを使用するデータ」のtry and errorが可能に！</li>
<li>ゲームシーケンス: シーンによってメモリの利用方法が変わる</li>
<li>動的管理の問題
<ul>
<li>リーク、断片化、処理速度</li>
<li>これらを嫌って固定管理するプログラマも多い</li>
</ul></li>
<li>std::free、deleteを忘れるとリークする
<ul>
<li>メモリの開放を他のプログラマに委ねる場合に起きる <code>Register</code> と <code>UnRegister</code> など</li>
</ul></li>
<li>RAII (Resource Acquisition Is Initialization)
<ul>
<li>オブジェクトとリソースの生存時間をそろえる</li>
<li>実装例: shared_ptr</li>
</ul></li>
<li><code>new</code> と <code>delete</code> を使わない
<ul>
<li>モジュールごとに shared_ptr で分離される</li>
<li>生ポインタは動作速度が必要なときのみ</li>
</ul></li>
<li>コンストラクタで初期化できるようにする
<ul>
<li>C++ の閉じかっこの強さを利用する</li>
</ul></li>
<li>std::mallocを使う必要がある場合 =&gt; バイナリデータ読み込み
<ul>
<li>std::freeの書き忘れが起きる</li>
<li>リーク検出ツールで検出 → 簡単に作れるよ！</li>
</ul></li>
<li>今時のOSはアロケータを差し替えられる
<ul>
<li>例: win の <code>_cdecl operator new</code></li>
<li>ここでデバグ情報を保存する</li>
</ul></li>
<li>リークしているアドレスは生存期間が長い
<ul>
<li>アドレスに日付を付ける</li>
<li>常駐データなど、解放しないものもある</li>
<li>コールスタックも保存。1回のみのモノは常駐データ</li>
<li>winの場合は<code>RtlCaptureStackBackTrace</code></li>
</ul></li>
<li>「同一のコールスタックから生存時間の長いメモリを複数回確保」をメモリリークとして検出
<ul>
<li>ログの分析はC#など使っている(C++ではちょっと)</li>
<li>jenkinsにまとめるといいでしょう</li>
</ul></li>
<li>断片化: 連続したメモリが確保できない状態
<ul>
<li>メモリは空いてるのに確保に失敗</li>
<li>MMU(memory management unit)の有無で変わる(ふつうのPCならあるけど、ないマシンも多い)</li>
<li>ハードウェア構成によって断片化のしやすさ代わる
<ul>
<li>ハードによって戦略が変わる</li>
</ul></li>
</ul></li>
<li>MMU非搭載
<ul>
<li>物理アドレス空間の断片化に要注意</li>
<li>物理メモリ16MBなどの組込。固定管理の方が適してる</li>
</ul></li>
<li>MMU搭載 (幸せなプログラミングができる。運がいい)
<ul>
<li>仮想メモリ空間の大きさを当てにして、何もしない</li>
<li>ゲームは、物理メモリ量に収まるサイズのアプリになるはずなので</li>
<li>64bit Win8.1 : 128TB。ページ単位のブロックアロケータ。断片化気にしない
<ul>
<li>トラブったら設計がまずいはず</li>
<li>Blackhat 2010 Understanding the Low Fragmentaton Heap</li>
</ul></li>
</ul></li>
<li>MMU搭載で仮想アドレスと実メモリに差が少ない場合
<ul>
<li>例: 32bit Windows XP で 2GByteのゲーム</li>
<li>断片化にかなり注意が必要</li>
<li>生存時間の長いメモリを減らす</li>
<li>生存時間の違うメモリのアドレスを、離す</li>
</ul></li>
<li>生存時間の長いメモリを減らすには
<ul>
<li>相互参照を減らして、速やかに開放できるようにする</li>
<li>長時間駆動に耐えやすい</li>
<li>依存関係が増えやすいときは <code>weak_ptr</code></li>
<li>シーケンス切り替え時にモジュールを捨てる。状態データのみ抽出して引き継ぐ</li>
<li>シーケンスデータ移行モジュールを作ることも</li>
</ul></li>
<li>シングルトン、グローバルインスタンスは極力使わない
<ul>
<li>グローバルインスタンスを先頭にとる。断片化が起きない</li>
</ul></li>
<li>生存時間の違うアドレスを分ける
<ul>
<li>アロケータを複数 or Double Ended Stack allocator (上からか下からか選べるアロケータ)</li>
</ul></li>
<li>VRAM : 断片化する
<ul>
<li>メインメモリよりは気楽にとらえることも</li>
<li>アドレスをプログラム側に渡してない
<ul>
<li>いざとなったらメモリコンパクションを実装</li>
<li>メインメモリでは厳しいよね</li>
</ul></li>
</ul></li>
<li>動的確保に見合った処理速度にするしかない
<ul>
<li>教科書通りの高速化は実施 (User-landで実施するアロケータ作るとか)</li>
<li>User-landとKernel-landの切り替えは時間がかかる</li>
</ul></li>
<li>生産性とのバランスの問題
<ul>
<li>速度か開発の柔軟性</li>
<li>処理の高速性が求められるところのみ頑張ればO.K.では</li>
</ul></li>
<li>リークツールは3日か4日あれば組める程度でしょう</li>
<li>メモリが不足したらどうする？
<ul>
<li>不足しないようにゲームを作る</li>
<li>自動テスト・エージングでメモリ使用量を必ず把握する</li>
<li>断片化・リークを直してもダメなら、データ側を修正しなければならない</li>
<li>開発用ROMではたくさんメモリ使えるからデザイナさんが頑張っちゃったりするけど</li>
</ul></li>
<li>動的管理によるいいこと
<ul>
<li>多彩なデータを動作させることが可能に</li>
<li>デザイナ、アーティストのクリエイティブてぃを引き出す！ 面白いゲームを！</li>
</ul></li>
<li>Q. ユニークポインタを使わずに shared_ptr がメイン？
<ul>
<li>A. new, delete は使わずにスマートポインタを使おう</li>
</ul></li>
</ul>
<h2 id="aizen76-さん-ue4とunreal-cでのプログラミング環境について"><span class="citation">@aizen76</span> さん 「UE4とUnreal C++でのプログラミング環境について」</h2>
<ul>
<li>Unreal Engine 4
<ul>
<li>2015年 無料化が発表された</li>
<li>3Dでも2Dでも</li>
<li>ドラクエ11のPS4版</li>
<li>デスノートのリュークのCGも</li>
<li>アニメ会社とかでも注目度が高い</li>
<li>ブループリント(ビジュアルなスクリプトシステム)を使うのがオススメ</li>
<li>「ボクが作るならはC++のコード一行もかきません」</li>
</ul></li>
<li>C++を使う理由
<ul>
<li>パフォーマンスの追及(速さは十分だけど、数十～数百倍の差が出ることも)</li>
<li>エンジン・エディタを拡張したい (ほとんどの部分が公開されていて拡張可能)
<ul>
<li>pull-reqしたりできるよ</li>
</ul></li>
<li>外部ライブラリやSDKの使用 (OpenCVとか)</li>
<li>独自デバイスの利用 (KINECTとか)</li>
<li>C++の勉強！</li>
</ul></li>
<li>“Unreal C++ is Awesome!” 自画自賛
<ul>
<li>初心者向けC++。独自拡張。Unreal Editorとの親和性</li>
<li>C#やJSの特徴も</li>
</ul></li>
<li>Unreal BuildTool → Mono C# → VisualStudio OR Xcode</li>
<li>UnrealBuild Tool
<ul>
<li>C++のメタ情報</li>
</ul></li>
<li>Mono C#
<ul>
<li>クロスプラットフォームを意識したモジュールの管理・リンク</li>
</ul></li>
<li>Windows, Macで動く。Linuxでも実は動く</li>
<li>比較的モダンC++
<ul>
<li>Range based forに対応</li>
<li>ムーブセマンティクス (右辺値参照)</li>
<li>コンテナのアルゴリズムにラムダ式</li>
<li>auto, enum</li>
<li>ただし、対応してないコンパイラがある機能には慎重 (マルチプラットフォームなので)</li>
<li>テンプレートとか難解な部分はなるべく使わない</li>
</ul></li>
<li>コーディングルールが決まっている
<ul>
<li>C#の標準にかなり近い</li>
<li>C++の標準よりこちらを</li>
<li>「中かっこ論争は醜い」</li>
<li>誰が書いたかわからないくらい普通のルール</li>
</ul></li>
<li>STLは使わない。ゲーム用に特化したいいライブラリがあるので
<ul>
<li>boostとか無理やり使うと苦しくなる</li>
</ul></li>
<li>C++標準より圧倒的にコンテナ多い。50種類くらいある
<ul>
<li>TArray, TSet, TMap (std::unordered_* とか書かなくていい)</li>
<li>FString (std::stringベースだがほぼ別物), FText (言語切り替えに対応), FName (静的文字列。速い。アセットの名前などに)
<ul>
<li>ネットワーク周りのエンディアンとかにも対応</li>
</ul></li>
<li>C#ライクなデリゲート。ダイナミックデリゲート(特殊。シリアライズ可能)</li>
</ul></li>
<li>Unreal Editorが自動でコード生成
<ul>
<li>.cppと.hも個別に作らない</li>
<li>wizardみたいな感じで</li>
</ul></li>
<li>GCあり。UnrealObject (UObject) を継承していれば
<ul>
<li>GC最適化可能 (呼び出し感覚、強制GC、並列化、オブジェクトプールなど)</li>
<li>メモリの可視化</li>
</ul></li>
<li>UObjectじゃないものはスマートポインタ
<ul>
<li>TSharedPtr, TSharedRef, TWeakPtr</li>
<li>ゲームで使用する前提の設計</li>
<li>スレッドセーフじゃなく、標準スマートポインタより早い</li>
<li>TThreadSafeSharedPtr (ロックフリーアルゴリズム)</li>
<li>コピー時にメモリ割り当てしない</li>
<li>例外使わない</li>
</ul></li>
<li>C++にメタ情報はない
<ul>
<li>RTTI(実行時型情報)はある</li>
<li>Unreal Header Tool にて実現
<ul>
<li>UCLASS, UPROPERTY, UFUNCTION, USTRICT のようなアノテーション</li>
<li>reflectionだけでなく、様々な情報を追加可能</li>
<li>ブループリントとの連携に利用 (BlueprintReadWrite, BlueprintCallable)</li>
</ul></li>
</ul></li>
<li>ホットリロード
<ul>
<li>ゲーム実行中にC++コードを書き換えることができる</li>
<li>部分的にDLLをリロードできる (Mono C# がやってる)</li>
</ul></li>
<li>ホットリロードのデモ
<ul>
<li>C++コード(Actor)を追加</li>
<li>ヘッダを書き換えるとビルドが遅くなるので、try and error はヘッダを書き換えない方が</li>
<li>ゲーム実行中にマネキンを設置、C++コードを書く、ビルドすると回転を始める</li>
<li>さらにC++を書いてビルド → 失敗。エラー箇所にジャンプできる</li>
<li>さらにC++を書いてビルド → 失敗。ライブデバグ</li>
<li>「何度も成功してたのですが、やはり生は怖いですね」</li>
<li>プロパティはblue print 上から見えるようになる</li>
<li>「ログのLがlに！」 → コンソールにライフの表示を成功</li>
<li>コンソールへクラス名を吐く (リフレクションの例)</li>
<li>再起動。Visual Studioとの接続を切断</li>
<li>Unreal Engineでソースコードをエディットする (VCのインストールはいるけど、立ち上げなくていい)
<ul>
<li>VCは重いから。ただしエディタはしょぼい</li>
</ul></li>
<li>blue printからVCで該当行にジャンプとか</li>
</ul></li>
<li>Unreal C++ は素晴らしい。ただし、ブループリントで十分にゲームを作れる</li>
<li>Unreal Fest 2015 横浜というイベントがあるよ (1000人まで)</li>
<li>UE4 GameJamというイベントを関西でやるよ (20人まで)</li>
<li>Q. コーディング規約をサポートするツールはあるの？
<ul>
<li>A. ツールはなさそう。レビューで直しているようだ。ルールで書けないところもあるので難しい</li>
</ul></li>
<li>Q. Unreal C++でラムダ式は使える？
<ul>
<li>A. はい。VC++で使える機能なら</li>
</ul></li>
<li>Q. コンパイル速度はマシン性能による？
<ul>
<li>A. VCのコンパイラ速度に依存。モジュール単位でビルドしてるので普通より速いはず</li>
<li>Q. 今のはでもマシンの性能のせい？</li>
<li>A. はい。普通は5秒。ハイスペックマシンを使って</li>
</ul></li>
<li>Q. コンパイル速度を速くするツールとかノウハウを
<ul>
<li>A. すでにやられている。我々ができることはほとんどない</li>
<li>Q. 分散ビルドは？</li>
<li>A. 公式にサポートされてるので、使っても</li>
</ul></li>
<li>Q. C++14への対応は？
<ul>
<li>A. 少しずつ増えている。VC++やXCodeが対応されていれば</li>
</ul></li>
<li>Q. コンパイラの選択はできる？ clangとか
<ul>
<li>A. 去年の12月に出てきている。問題はまだある</li>
</ul></li>
</ul>
<!--
## @shw95349 さん 「元コンシューマ系PGがアケゲ開発やってみた　～アケゲ開発でのC++～」

## @hotwatermorning さん 「JUCEで作るオーディオアプリケーション」

## @tsuchidasama さん 「プログラマの生存戦略 ～生き残る為に出世しろ～」
-->
</p>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hiratara';
    var disqus_title = '今日は「Event for Diverse Game Engineers」の日です';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      </div>
    </div>
    <div id="content_footer"></div>
    <div id="footer">
      <p><a href="../">Home</a> | <a href="../about.html">About</a> | <a href="../contact.html">Contact</a> | <a href="../archive.html">Archive</a></p>
      <p>Copyright &copy; hiratara | <a href="http://validator.w3.org/check?uri=referer">HTML5</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> | <a href="http://www.html5webtemplates.co.uk">Free CSS Templates</a> | <a href="http://jaspervdj.be/hakyll">Hakyll</a></p>
    </div>
  </div>
</body>
</html>
